# Puresign

Puresign æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæå–æ‰‹å†™ç­¾åå’Œæ–‡å­—çš„å›¾åƒå¤„ç†æœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé«˜æ€§èƒ½çš„ Python åç«¯ APIï¼Œèƒ½å¤Ÿå»é™¤å›¾ç‰‡ä¸­çš„å¤æ‚èƒŒæ™¯ï¼Œæå–å‡ºå¹²å‡€ã€é€æ˜èƒŒæ™¯çš„ç­¾åçº¿æ¡ï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰çº¿æ¡é¢œè‰²ã€‚

## ğŸ‘‹ å‰ç«¯å¼€å‘è€…çš„ Python æŒ‡å—

æ—¢ç„¶ä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ Python é¡¹ç›®ï¼Œè¿™é‡Œæœ‰ä¸€äº›å…³é”®æ¦‚å¿µçš„ç±»æ¯”ï¼Œå¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ï¼š

| Python æ¦‚å¿µ | å‰ç«¯/Node.js ç±»æ¯” | è¯´æ˜ |
| :--- | :--- | :--- |
| **`python`** | `node` | è¿è¡Œç¯å¢ƒã€‚æœ¬é¡¹ç›®è¦æ±‚ Python 3.11+ |
| **`uv`** | `npm` / `pnpm` | **åŒ…ç®¡ç†å™¨**ã€‚ä½ éœ€è¦ç”¨å®ƒæ¥å®‰è£…ä¾èµ–ã€å¹¶åœ¨éš”ç¦»çš„è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œè„šæœ¬ã€‚ |
| **`pyproject.toml`** | `package.json` | é…ç½®æ–‡ä»¶ã€‚å®šä¹‰äº†é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€ä¾èµ–åˆ—è¡¨ä»¥åŠå·¥å…·é…ç½®ã€‚ |
| **`poe`** (PoeThePoet) | `npm scripts` | **ä»»åŠ¡è¿è¡Œå™¨**ã€‚å®šä¹‰ç®€å•çš„å‘½ä»¤åˆ«åï¼ˆå¦‚ `dev`, `lint`ï¼‰ã€‚ |
| **FastAPI** | Express.js / Next.js API | Web æ¡†æ¶ã€‚æˆ‘ä»¬ç”¨å®ƒæ¥å¤„ç† HTTP è¯·æ±‚å’Œè·¯ç”±ã€‚ |
| **OpenCV** (`cv2`) | Canvas API (æœåŠ¡ç«¯ç‰ˆ) | å¼ºå¤§çš„å›¾åƒå¤„ç†åº“ï¼Œç”¨äºåšåƒç´ çº§çš„æ“ä½œï¼ˆå»åº•ã€äºŒå€¼åŒ–ï¼‰ã€‚ |
| **Ruff** | ESLint + Prettier | æé€Ÿçš„ä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥å·¥å…·ã€‚ |
| **Ty** | TypeScript (tsc) | **é™æ€ç±»å‹æ£€æŸ¥å™¨**ã€‚Python æ˜¯åŠ¨æ€è¯­è¨€ï¼ŒåŠ ä¸Š Type Hints åå°±åƒ TS ä¸€æ ·å®‰å…¨ã€‚ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…å·¥å…·é“¾
æœ¬é¡¹ç›®ä½¿ç”¨ **[uv](https://github.com/astral-sh/uv)** è¿›è¡Œå…¨æ ˆç®¡ç†ã€‚ä½ éœ€è¦å…ˆå®‰è£…å®ƒï¼š
```bash
# Mac/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### 2. åˆå§‹åŒ–é¡¹ç›® & åŒæ­¥ä¾èµ–
åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿™å°†å®‰è£…ä¾èµ–å¹¶è‡ªåŠ¨é…ç½® Git Hooksï¼ˆä»£ç æ£€æŸ¥ä¸æäº¤è§„èŒƒï¼‰ï¼š
```bash
uv run poe setup
```
> **æ³¨æ„**ï¼šå¦‚æœæœªæ¥ä¾èµ–æœ‰æ›´æ–°ï¼Œè¯·è¿è¡Œ `uv sync` åŒæ­¥ç¯å¢ƒã€‚

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
uv run poe dev
```
*   è¿™ç›¸å½“äº `npm run dev`ã€‚
*   æœåŠ¡å™¨å°†åœ¨ `http://127.0.0.1:8008` å¯åŠ¨ã€‚
*   æ”¯æŒçƒ­é‡è½½ï¼ˆä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡å¯ï¼‰ã€‚

---

## âŒ¨ï¸ å¼€å‘å·¥ä½œæµ

æœ¬é¡¹ç›®é…ç½®äº†è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼ˆç±»ä¼¼ `npm run xxx`ï¼‰ï¼Œç»Ÿä¸€ä½¿ç”¨ `poe` ç®¡ç†ã€‚å¯ä»¥é€šè¿‡ `uv run poe <task>` è¿è¡Œï¼š

| ä»»åŠ¡å‘½ä»¤ | ä½œç”¨ | Node.js ç±»æ¯” |
| :--- | :--- | :--- |
| **`uv run poe dev`** | å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (Hot Reload) | `npm run dev` |
| **`uv run poe start`** | å¯åŠ¨ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨ | `npm start` |
| **`uv run poe check`** | **ä¸€é”®æ£€æŸ¥**ï¼šæ ¼å¼åŒ– + Lint + ç±»å‹æ£€æŸ¥ | `npm run check` |
| **`uv run poe format`** | æ ¼å¼åŒ–ä»£ç  (Ruff) | `npm run format` |
| **`uv run poe lint`** | æ£€æŸ¥ä»£ç é£æ ¼å¹¶ä¿®å¤ (Ruff) | `npm run lint` |
| **`uv run poe type`** | è¿è¡Œç±»å‹æ£€æŸ¥ (Ty) | `npm run type-check` |
| **`uv run poe build`** | æ„å»ºé¡¹ç›®åŒ… | `npm run build` |

### âœ… Git æäº¤è§„èŒƒ
æœ¬é¡¹ç›®é›†æˆäº† **[Pre-commit](https://pre-commit.com/)** å’Œ **[Commitizen](https://commitizen-tools.github.io/commitizen/)**ï¼š

1.  **Pre-commit Hook**: æ¯æ¬¡ `git commit` æ—¶ï¼Œä¼šè‡ªåŠ¨è¿è¡Œ `check` ä»»åŠ¡ã€‚å¦‚æœæœ‰ä»£ç é£æ ¼é”™è¯¯ï¼Œæäº¤ä¼šè¢«é˜»æ­¢ã€‚
2.  **Commit Message**: æäº¤ä¿¡æ¯å¿…é¡»éµå®ˆ [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒã€‚
    *   âŒ `fix bug`
    *   âœ… `fix: handle transparent background correctly`
    *   âœ… `feat: add color customization`

---

## ğŸ›  åŠŸèƒ½ä¸æµ‹è¯•

### å†…ç½®æµ‹è¯•é¡µé¢
å¯åŠ¨æœåŠ¡åï¼Œç›´æ¥è®¿é—®ï¼š
ğŸ‘‰ **http://127.0.0.1:8008/test**

è¿™æ˜¯ä¸€ä¸ªå†…ç½®çš„ç®€å• HTML é¡µé¢ï¼Œä½ å¯ä»¥ï¼š
1. ä¸Šä¼ ä¸€å¼ åŒ…å«ç­¾åçš„å›¾ç‰‡ã€‚
2. å®æ—¶çœ‹åˆ°å»åº•åçš„æ•ˆæœã€‚
3. è°ƒæ•´æå–åçš„ç­¾åé¢œè‰²ã€‚

### API æ–‡æ¡£
FastAPI è‡ªå¸¦äº†éå‡¡çš„è‡ªåŠ¨æ–‡æ¡£åŠŸèƒ½ï¼ˆSwagger UIï¼‰ï¼š
ğŸ‘‰ **http://127.0.0.1:8008/docs**

ä½ å¯ä»¥åœ¨è¿™ä¸ªé¡µé¢ç›´æ¥æµ‹è¯• API æ¥å£ã€‚

### æ ¸å¿ƒ API
**`POST /extract`**
*   **Request**: `multipart/form-data`
    *   `file`: å›¾ç‰‡æ–‡ä»¶
    *   `color` (Query Param, å¯é€‰): ç›®æ ‡é¢œè‰²ä»£ç  (ä¾‹å¦‚ `%23FF0000` ä»£è¡¨çº¢è‰²)ï¼Œé»˜è®¤é»‘è‰²ã€‚
*   **Response**: `image/png` (å¸¦æœ‰é€æ˜èƒŒæ™¯çš„å›¾ç‰‡æµ)

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
puresign/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ puresign/
â”‚       â”œâ”€â”€ main.py       # æ ¸å¿ƒé€»è¾‘å…¥å£ (ç±»ä¼¼ index.js + controller)
â”‚       â””â”€â”€ test.html     # ç”¨äºæµ‹è¯•çš„ç®€å•å‰ç«¯é¡µé¢
â”œâ”€â”€ pyproject.toml        # === package.json (é…ç½®ä¸­å¿ƒ)
â”œâ”€â”€ uv.lock              # === package-lock.json (ç‰ˆæœ¬é”å®š)
â”œâ”€â”€ .pre-commit-config.yaml # Git Hooks é…ç½®
â””â”€â”€ README.md
```

## ğŸ§© æ ¸å¿ƒé€»è¾‘è§£æ

æ ¸å¿ƒå›¾åƒå¤„ç†å‡½æ•° `process_signature` åœ¨ `src/puresign/main.py` ä¸­ã€‚æµç¨‹å¦‚ä¸‹ï¼š
1.  **è§£ç **: `cv2.imdecode` è¯»å–å›¾ç‰‡ã€‚
2.  **é¢„å¤„ç†**: ç»Ÿä¸€å¤„ç†å›¾ç‰‡é€æ˜åº¦é€šé“ã€‚
3.  **ç°åº¦åŒ–**: `cv2.cvtColor` è½¬ç°åº¦ã€‚
4.  **è‡ªé€‚åº”é˜ˆå€¼**: `cv2.adaptiveThreshold` æ™ºèƒ½æå–æ–‡å­—çº¿æ¡ï¼Œå¿½ç•¥å…‰ç…§é˜´å½±ã€‚
5.  **æ„å»º Alpha**: å°†æå–çš„ Mask ä½œä¸º Alpha é€šé“ï¼Œå®ç°å»åº•ã€‚
6.  **ç€è‰²**: åƒç´ çº§é¢œè‰²æ›¿æ¢ã€‚

Enjoy your first Python journey! ğŸ
